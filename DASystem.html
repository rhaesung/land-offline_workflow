<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. Land Data Assimilation System &mdash; UFS Offline Land DA Develop Branch Documentation documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Glossary" href="Glossary.html" />
    <link rel="prev" title="3. Noah-MP Land Surface Model" href="Model_v0.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            UFS Offline Land DA
          </a>
              <div class="version">
                develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction_v0.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="TechnicalOverview.html">2. Technical Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Model_v0.html">3. Noah-MP Land Surface Model</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Land Data Assimilation System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#joint-effort-for-data-assimilation-integration-jedi">4.1. Joint Effort for Data Assimilation Integration (JEDI)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#oops">4.1.1. OOPS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#jedi-configuration-files">4.1.1.1. JEDI Configuration Files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#set-and-submit-the-da-cycle">4.2. Set and Submit the DA cycle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-files">4.2.1. Input Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#grid-description-files">4.2.1.1. Grid Description Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restart-files">4.2.1.2. Restart Files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#da-workflow">4.2.2. DA Workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#do-submit-cycle-sh">4.2.2.1. <code class="docutils literal notranslate"><span class="pre">do_submit_cycle.sh</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#submit-cycle-sh">4.2.2.2. <code class="docutils literal notranslate"><span class="pre">submit_cycle.sh</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#do-landda-sh">4.2.2.3. <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-experiment">4.2.3. Configure the Experiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#submit-the-experiment">4.2.4. Submit the Experiment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interface-for-observation-data-access-ioda">4.3. Interface for Observation Data Access (IODA)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">5. Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UFS Offline Land DA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">4. </span>Land Data Assimilation System</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/DASystem.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="land-data-assimilation-system">
<span id="dasystem"></span><h1><span class="section-number">4. </span>Land Data Assimilation System<a class="headerlink" href="#land-data-assimilation-system" title="Permalink to this headline"></a></h1>
<p>This chapter describes the configuration of the offline Land <a class="reference internal" href="Glossary.html#term-data-assimilation"><span class="xref std std-term">Data Assimilation</span></a> (DA) System to perform cycling model forecasts and DA using the UFS (GFS) code via Noah-MP CCPP code base with DA which is used the JEDI <code class="docutils literal notranslate"><span class="pre">fv3-jedi</span></code> bundle for land update.</p>
<div class="section" id="joint-effort-for-data-assimilation-integration-jedi">
<h2><span class="section-number">4.1. </span>Joint Effort for Data Assimilation Integration (JEDI)<a class="headerlink" href="#joint-effort-for-data-assimilation-integration-jedi" title="Permalink to this headline"></a></h2>
<p>The Joint Effort for Data assimilation Integration (<a class="reference internal" href="Glossary.html#term-jedi"><span class="xref std std-term">JEDI</span></a>) is a unified and versatile <a class="reference internal" href="Glossary.html#term-data-assimilation"><span class="xref std std-term">data assimilation</span></a> (DA) system for Earth System Prediction that can be run on a variety of platforms. JEDI is developed by the Joint Center for Satellite Data Assimilation (<a class="reference external" href="https://www.jcsda.org/">JCSDA</a>) and partner agencies, including NOAA. The core feature of JEDI is separation of concerns. The data assimilation update, observation selection and processing, and observation operators are all coded with no knowledge of or dependency on each other or on the forecast model.</p>
<p>The NOAH-MP offline Land DA System uses three JEDI components:</p>
<blockquote>
<div><ul class="simple">
<li><p>The Object-Oriented Prediction System (<a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/1.0.0/inside/jedi-components/oops/index.html">OOPS</a>) for the data assimilation algorithm</p></li>
<li><p>The Interface for Observation Data Access (<a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/1.0.0/inside/jedi-components/ioda/index.html">IODA</a>) for the observation formatting and processing</p></li>
<li><p>The Unified Forward Operator (<a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/1.0.0/inside/jedi-components/ufo/index.html">UFO</a>).</p></li>
</ul>
</div></blockquote>
<div class="section" id="oops">
<h3><span class="section-number">4.1.1. </span>OOPS<a class="headerlink" href="#oops" title="Permalink to this headline"></a></h3>
<p>User-specified <code class="docutils literal notranslate"><span class="pre">yaml</span></code> configuration files specify the details of the data assimilation and observation processing. OOPS provides the core set of data assimilation algorithms in JEDI by combining the generic building blocks required for the algorithms. The OOPS system does not require knowledge of any specific application model implementation structure or observation data information. In the NOAH-MP offline Land DA System, OOPS reads the model forecast states from the restart files generated by the Noah-MP model. JEDI UFO contains generic quality control options and filters that can be applied to each observation system, without coding at certain model application levels. More information on the key concepts of the JEDI software design can be found in <span id="id1">Trémolet and Auligné [<a class="reference internal" href="Introduction_v0.html#id23" title="Trémolet, Y. and T. Auligné. The joint effort for data assimilation integration (jedi). JCSDA Quarterly Newsletter, 66:1–5, 2020. doi:10.25923/RB19-0Q26.">TA20</a>]</span> (2020), <span id="id2">Holdaway <em>et al.</em> [<a class="reference internal" href="Introduction_v0.html#id20" title="D. Holdaway, G. Vernieres, M. Wlasak, and S. King. Status of model interfacing in the joint effort for data assimilation integration (jedi). JCSDA Quarterly Newsletter, 66:15–24, 2020. doi:10.25923/RB19-0Q26.">HVMWK20</a>]</span> (2020), and <span id="id3">Honeyager <em>et al.</em> [<a class="reference internal" href="Introduction_v0.html#id21" title="R. Honeyager, S. Herbener, X. Zhang, A. Shlyaeva, and Y. Trémolet. Observations in the joint effort for data assimilation integration (jedi) — unified forward operator (ufo) and interface for observation data access (ioda). JCSDA Quarterly Newsletter, 66:24–33, 2020. doi:10.25923/RB19-0Q26.">HHZ+20</a>]</span> (2020).</p>
<div class="section" id="jedi-configuration-files">
<h4><span class="section-number">4.1.1.1. </span>JEDI Configuration Files<a class="headerlink" href="#jedi-configuration-files" title="Permalink to this headline"></a></h4>
<p>To create the DA experiment, the user should create or modify an experiment-specific configuration <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file. This <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file should contain certain fundamental components: geometry, window begin, window length, background, driver, local ensemble DA, output increment, and observations. These components can be implemented differently for different models and observations types, so they frequently contain distinct parameters and variable names depending on the use case. Therefore, this section of the User’s Guide focuses on assisting users with understanding and customizing these top-level configuration items in order to run Land DA experiments. Users may also reference the <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/latest/using/building_and_running/config_content.html">JEDI Documentation</a> for additional information.</p>
<p>Users may find the following example <code class="docutils literal notranslate"><span class="pre">yaml</span></code> configuration file to be a helpful starting point. This file (with user-appropriate modifications) is required by JEDI for snow data assimilation. The following subsections will explain the variables within each top-level item of the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">geometry:</span>
<span class="go">  fms initialization:</span>
<span class="go">    namelist filename: Data/fv3files/fmsmpp.nml</span>
<span class="go">    field table filename: Data/fv3files/field_table</span>
<span class="go">  akbk: Data/fv3files/akbk64.nc4</span>
<span class="go">  npx: 97</span>
<span class="go">  npy: 97</span>
<span class="go">  npz: 64</span>
<span class="go">  field metadata override: Data/fieldmetadata/gfs-land.yaml</span>

<span class="go">  time invariant state fields:</span>
<span class="go">    datetime: 2016-01-02T12:00:00Z</span>
<span class="go">    filetype: fms restart</span>
<span class="go">    skip coupler file: true</span>
<span class="go">    state variables: [orog_filt]</span>
<span class="go">    datapath: /*/</span>
<span class="go">    filename_orog: oro_C96.mx100.nc</span>

<span class="go">window begin: 2016-01-02T12:00:00Z</span>
<span class="go">window length: PT6H</span>

<span class="go">background:</span>
<span class="go">  date: &amp;date 2016-01-02T18:00:00Z</span>
<span class="go">  members:</span>
<span class="go">    - datetime: 2016-01-02T18:00:00Z</span>
<span class="go">      filetype: fms restart</span>
<span class="go">      state variables: [snwdph,vtype,slmsk]</span>
<span class="go">      datapath: mem_pos/</span>
<span class="go">      filename_sfcd: 20160102.180000.sfc_data.nc</span>
<span class="go">      filename_cplr: 20160102.180000.coupler.res</span>
<span class="go">    - datetime: 2016-01-02T18:00:00Z</span>
<span class="go">      filetype: fms restart</span>
<span class="go">      state variables: [snwdph,vtype,slmsk]</span>
<span class="go">      datapath: mem_neg/</span>
<span class="go">      filename_sfcd: 20160102.180000.sfc_data.nc</span>
<span class="go">      filename_cplr: 20160102.180000.coupler.res</span>

<span class="go">driver:</span>
<span class="go">  save posterior mean: false</span>
<span class="go">  save posterior mean increment: true</span>
<span class="go">  save posterior ensemble: false</span>
<span class="go">  run as observer only: false</span>

<span class="go">local ensemble DA:</span>
<span class="go">  solver: LETKF</span>
<span class="go">  inflation:</span>
<span class="go">    rtps: 0.0</span>
<span class="go">    rtpp: 0.0</span>
<span class="go">    mult: 1.0</span>

<span class="go">output increment:</span>
<span class="go">  filetype: fms restart</span>
<span class="go">  filename_sfcd: xainc.sfc_data.nc</span>

<span class="go">observations:</span>
<span class="go">  observers:</span>
<span class="go">  - obs space:</span>
<span class="go">    name: SnowDepthIMS</span>
<span class="go">    distribution:</span>
<span class="go">      name: Halo</span>
<span class="go">      halo size: 250e3</span>
<span class="go">    simulated variables: [totalSnowDepth]</span>
<span class="go">    observed variables: [totalSnowDepth]</span>
<span class="go">    obsdatain:</span>
<span class="go">      engine:</span>
<span class="go">        type: H5File</span>
<span class="go">        obsfile: ioda.IMSscf.20160102.oro_C96.mx100.nc</span>
<span class="go">    obsdataout:</span>
<span class="go">      engine:</span>
<span class="go">        type: H5File</span>
<span class="go">        obsfile: output/DA/hofx/letkf_hofx_ims_2016010218.nc</span>
<span class="go">  obs operator:</span>
<span class="go">    name: Identity</span>
<span class="go">  obs error:</span>
<span class="go">    covariance model: diagonal</span>
<span class="go">  obs localizations:</span>
<span class="go">  - localization method: Horizontal SOAR</span>
<span class="go">    lengthscale: 250e3</span>
<span class="go">    soar horizontal decay: 0.000021</span>
<span class="go">    max nobs: 1</span>
<span class="go">  obs filters:</span>
<span class="go">  - filter: Bounds Check # negative / missing snow</span>
<span class="go">    filter variables:</span>
<span class="go">    - name: totalSnowDepth</span>
<span class="go">      minvalue: 0.0</span>
<span class="go">  - filter: Domain Check # land only</span>
<span class="go">    where:</span>
<span class="go">    - variable:</span>
<span class="go">          name: slmsk@GeoVaLs</span>
<span class="go">        minvalue: 0.5</span>
<span class="go">        maxvalue: 1.5</span>
<span class="go">    - filter: RejectList  # no land-ice</span>
<span class="go">      where:</span>
<span class="go">      - variable:</span>
<span class="go">          name: vtype@GeoVaLs</span>
<span class="go">        minvalue: 14.5</span>
<span class="go">        maxvalue: 15.5</span>
<span class="go">    - filter: Background Check # gross error check</span>
<span class="go">      filter variables:</span>
<span class="go">      - name: totalSnowDepth</span>
<span class="go">      threshold: 6.25</span>
<span class="go">      action:</span>
<span class="go">        name: reject</span>
</pre></div>
</div>
<div class="section" id="geometry">
<h5><span class="section-number">4.1.1.1.1. </span>Geometry<a class="headerlink" href="#geometry" title="Permalink to this headline"></a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">geometry:</span></code> section is used in JEDI configuration files to specify the model grid’s parallelization across compute nodes (horizontal and vertical).</p>
<blockquote>
<div><dl>
<dt><code class="docutils literal notranslate"><span class="pre">fms</span> <span class="pre">initialization</span></code></dt><dd><p>This section contains two parameters, <code class="docutils literal notranslate"><span class="pre">namelist</span> <span class="pre">filename</span></code> and <code class="docutils literal notranslate"><span class="pre">field</span> <span class="pre">table</span> <span class="pre">filename</span></code>.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">namelist</span> <span class="pre">filename</span></code></dt><dd><p>Specifies the path for the namelist filename.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">field</span> <span class="pre">table</span> <span class="pre">filename</span></code></dt><dd><p>Specifies the path for the field table filename.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">akbk</span></code></dt><dd><p>Specifies the path to a file containing the coefficients that define the hybrid sigma-pressure vertical coordinate used in FV3. Files are provided with the repository containing <code class="docutils literal notranslate"><span class="pre">ak</span></code> and <code class="docutils literal notranslate"><span class="pre">bk</span></code> for some common choices of vertical resolution for GEOS and GFS.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">npx</span></code></dt><dd><p>Specifies the number of grid cells in the east-west direction.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">npy</span></code></dt><dd><p>Specifies the number of grid cells in the north-south direction</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">npz</span></code></dt><dd><p>Specifies the number of vertical layers.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">field</span> <span class="pre">metadata</span> <span class="pre">override</span></code></dt><dd><p>Specifies the path for file metadata.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">invariant</span> <span class="pre">state</span> <span class="pre">fields</span></code></dt><dd><p>This parameter contains several subparameters listed below.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">datetime</span></code></dt><dd><p>Specifies the time in YYYY-MM-DDTHH:00:00Z format, where YYYY is a 4-digit year, MM is a valid 2-digit month, DD is a valid 2-digit day, and HH is a valid 2-digit hour.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">filetype</span></code></dt><dd><p>Specifies the type of file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">skip</span> <span class="pre">coupler</span> <span class="pre">file</span></code></dt><dd><p>Specifies whether to enable skipping coupler file. Valid values are: <code class="docutils literal notranslate"><span class="pre">true</span></code> | <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>true</p></td>
<td><p>enable</p></td>
</tr>
<tr class="row-odd"><td><p>false</p></td>
<td><p>do not enable</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">state</span> <span class="pre">variables</span></code></dt><dd><p>Specifies the list of state variables. Valid values: <code class="docutils literal notranslate"><span class="pre">[orog_filt]</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">datapath</span></code></dt><dd><p>Specifies the path for state variables data.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">filename_orog</span></code></dt><dd><p>Specifies the name of orographic data file.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="window-begin-window-length">
<h5><span class="section-number">4.1.1.1.2. </span>Window begin, Window length<a class="headerlink" href="#window-begin-window-length" title="Permalink to this headline"></a></h5>
<p>These two items define the assimilation window for many applications, including Land DA.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">window</span> <span class="pre">begin:</span></code></dt><dd><p>Specifies the beginning time window. The format is YYYY-MM-DDTHH:00:00Z, where YYYY is a 4-digit year, MM is a valid 2-digit month, DD is a valid 2-digit day, and HH is a valid 2-digit hour.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">window</span> <span class="pre">length:</span></code></dt><dd><p>Specifies the time window length. The form is PTXXH, where XX is a 2-digit hour.</p>
</dd>
</dl>
</div>
<div class="section" id="background">
<h5><span class="section-number">4.1.1.1.3. </span>Background<a class="headerlink" href="#background" title="Permalink to this headline"></a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">background:</span></code> section includes information on the analysis file(s) (also known as “members”) generated by the previous cycle.</p>
<blockquote>
<div><dl>
<dt><code class="docutils literal notranslate"><span class="pre">date</span></code></dt><dd><p>Specifies the background date. The format is <code class="docutils literal notranslate"><span class="pre">&amp;date</span> <span class="pre">YYYY-MM-DDTHH:00:00Z</span></code>, where YYYY is a 4-digit year, MM is a valid 2-digit month, DD is a valid 2-digit day, and HH is a valid 2-digit hour. For example: <code class="docutils literal notranslate"><span class="pre">&amp;date</span> <span class="pre">2016-01-02T18:00:00Z</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">members</span></code></dt><dd><p>Specifies information on analysis file(s) generated by a previous cycle.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">datetime</span></code></dt><dd><p>Specifies the time. The format is YYYY-MM-DDTHH:00:00Z, where YYYY is a 4-digit year, MM is a valid 2-digit month, DD is a valid 2-digit day, and HH is a valid 2-digit hour.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">filetype</span></code></dt><dd><p>Specifies the type of file. Valid values: <code class="docutils literal notranslate"><span class="pre">fms</span> <span class="pre">restart</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">state</span> <span class="pre">variables</span></code></dt><dd><p>Specifies a list of state variables. Valid values: <code class="docutils literal notranslate"><span class="pre">[snwdph,vtype,slmsk]</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">datapath</span></code></dt><dd><p>Specifies the path for state variables data. Valid values: <code class="docutils literal notranslate"><span class="pre">mem_pos/</span></code> | <code class="docutils literal notranslate"><span class="pre">mem_neg/</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">filename_sfcd</span></code></dt><dd><p>Specifies the name of surface data file. This usually takes the form <code class="docutils literal notranslate"><span class="pre">YYYYMMDD.HHmmss.sfc_data.nc</span></code>, where YYYY is a 4-digit year, MM is a valid 2-digit month, DD is a valid 2-digit day, and HH is a valid 2-digit hour, mm is a valid 2-digit minute and ss is a valid 2-digit second. For example: <code class="docutils literal notranslate"><span class="pre">20160102.180000.sfc_data.nc</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">filename_cprl</span></code></dt><dd><p>Specifies the name of file that contains metadata for the restart. This usually takes the form <code class="docutils literal notranslate"><span class="pre">YYYYMMDD.HHmmss.coupler.res</span></code>, where YYYY is a 4-digit year, MM is a valid 2-digit month, DD is a valid 2-digit day, and HH is a valid 2-digit hour, mm is a valid 2-digit minute and ss is a valid 2-digit second. For example: <code class="docutils literal notranslate"><span class="pre">20160102.180000.coupler.res</span></code></p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="driver">
<h5><span class="section-number">4.1.1.1.4. </span>Driver<a class="headerlink" href="#driver" title="Permalink to this headline"></a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">driver:</span></code> section describes optional modifications to the behavior of the LocalEnsembleDA driver. For details, refer to <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/latest/inside/jedi-components/oops/applications/localensembleda.html">Local Ensemble Data Assimilation in OOPS</a> in the JEDI Documentation.</p>
<blockquote>
<div><dl>
<dt><code class="docutils literal notranslate"><span class="pre">save</span> <span class="pre">posterior</span> <span class="pre">mean</span></code></dt><dd><p>Specifies whether to save the posterior mean. Valid values: <code class="docutils literal notranslate"><span class="pre">true</span></code> | <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>true</p></td>
<td><p>save</p></td>
</tr>
<tr class="row-odd"><td><p>false</p></td>
<td><p>do not save</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">save</span> <span class="pre">posterior</span> <span class="pre">mean</span> <span class="pre">increment</span></code></dt><dd><p>Specifies whether to save the posterior mean increment. Valid values: <code class="docutils literal notranslate"><span class="pre">true</span></code> | <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>true</p></td>
<td><p>enable</p></td>
</tr>
<tr class="row-odd"><td><p>false</p></td>
<td><p>do not enable</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">save</span> <span class="pre">posterior</span> <span class="pre">ensemble</span></code></dt><dd><p>Specifies whether to save the posterior ensemble. Valid values: <code class="docutils literal notranslate"><span class="pre">true</span></code> | <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>true</p></td>
<td><p>enable</p></td>
</tr>
<tr class="row-odd"><td><p>false</p></td>
<td><p>do not enable</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">as</span> <span class="pre">observer</span> <span class="pre">only</span></code></dt><dd><p>Specifies whether to run as observer only. Valid values: <code class="docutils literal notranslate"><span class="pre">true</span></code> | <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>true</p></td>
<td><p>enable</p></td>
</tr>
<tr class="row-odd"><td><p>false</p></td>
<td><p>do not enable</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="local-ensemble-da">
<h5><span class="section-number">4.1.1.1.5. </span>Local Ensemble DA<a class="headerlink" href="#local-ensemble-da" title="Permalink to this headline"></a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">local</span> <span class="pre">ensemble</span> <span class="pre">DA:</span></code> section configures the local ensemble DA solver package.</p>
<blockquote>
<div><dl>
<dt><code class="docutils literal notranslate"><span class="pre">solver</span></code></dt><dd><p>Specifies the type of solver. Currently, <code class="docutils literal notranslate"><span class="pre">LETKF</span></code> is the only available option. See <span id="id4">Hunt <em>et al.</em> [<a class="reference internal" href="Introduction_v0.html#id22" title="B.R. Hunt, E.J. Kostelich, and I. Szunyogh. Efficient data assimilation for spatiotemporal chaos: a local ensemble transform kalman filter. Physica D: Nonlinear Phenomena, 230(1–2):112–126, 2007. doi:10.1016/j.physd.2006.11.008.">HEJKS07</a>]</span>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">inflation</span></code></dt><dd><p>Describes covariance inflation methods.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">rtps</span></code></dt><dd><p>Relaxation to prior spread (<span id="id5">Whitaker and Hamill [<a class="reference internal" href="Introduction_v0.html#id24" title="Whitaker, J.S. and T.M. Hamill. Evaluating methods to account for system errors in ensemble data assimilation. Monthly Weather Review, 140(9):3078–3089, 2012. doi:10.1175/MWR-D-11-00276.1.">WH12</a>]</span>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rtpp</span></code></dt><dd><p>Relaxation to prior perturbation (<span id="id6">Zhang <em>et al.</em> [<a class="reference internal" href="Introduction_v0.html#id25" title="F. Zhang, C. Snyder, and J. Sun. Impacts of initial estimate and observation availability on convective-scale data assimilation with an ensemble kalman filter. Monthly Weather Review, 132(5):1238–1253, 2004. doi:10.1175/1520-0493(2004)132%3C1238:IOIEAO%3E2.0.CO;2.">ZCSS04</a>]</span>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mult</span></code></dt><dd><p>Parameter of multiplicative inflation.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="output-increment">
<h5><span class="section-number">4.1.1.1.6. </span>Output Increment<a class="headerlink" href="#output-increment" title="Permalink to this headline"></a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">output</span> <span class="pre">increment:</span></code> section…</p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">filetype</span></code></dt><dd><p>Type of file provided for the output increment. Valid values: <code class="docutils literal notranslate"><span class="pre">fms</span> <span class="pre">restart</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">filename_sfcd</span></code></dt><dd><p>Name of the file provided for the output increment. For example: <code class="docutils literal notranslate"><span class="pre">xainc.sfc_data.nc</span></code></p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="observations">
<h5><span class="section-number">4.1.1.1.7. </span>Observations<a class="headerlink" href="#observations" title="Permalink to this headline"></a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">observations:</span></code> item describes one or more types of observations, each of which is a multi-level YAML/JSON object in and of itself. Each of these observation types is read into JEDI as an <code class="docutils literal notranslate"><span class="pre">eckit::Configuration</span></code> object (see <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/1.0.0/using/building_and_running/config_content.html#observations">JEDI Documentation</a> for more details).</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">observers</span></code></p>
<blockquote>
<div></div></blockquote>
</div></blockquote>
<div class="section" id="obs-space">
<h6><span class="section-number">4.1.1.1.7.1. </span><code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">space:</span></code><a class="headerlink" href="#obs-space" title="Permalink to this headline"></a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">space:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> comes under the <code class="docutils literal notranslate"><span class="pre">observations.observers:</span></code> section and describes the configuration of the observation space. An observation space handles observation data for a single observation type.</p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Specifies the name of observation space. Since the Land DA System uses IMS snow depth data, the sample configuration file uses the name <code class="docutils literal notranslate"><span class="pre">SnowDepthIMS</span></code>.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">distribution</span></code></p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Specifies the name of distribution. Valid values: <code class="docutils literal notranslate"><span class="pre">Halo</span></code> | InefficientDistribution</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">halo</span> <span class="pre">size</span></code></dt><dd><p>Specifies the size of the halo distribution. Valid values: <code class="docutils literal notranslate"><span class="pre">250e3</span></code></p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">simulated</span> <span class="pre">variables</span></code></dt><dd><p>Specifies the list of variables that need to be simulated by observation operator. Valid values: <code class="docutils literal notranslate"><span class="pre">[totalSnowDepth]</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">observed</span> <span class="pre">variables</span></code></dt><dd><p>Specifies the list of observed variables. Valid values: <code class="docutils literal notranslate"><span class="pre">[totalSnowDepth]</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">obsdatain</span></code></dt><dd><p>This section specifies information about the observation input data.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">engine</span></code></dt><dd><p>This section specifies parameters required for the file matching engine.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>Specifies the type of input observation data. Valid values: <code class="docutils literal notranslate"><span class="pre">H5File</span></code> | <code class="docutils literal notranslate"><span class="pre">OBS</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">obsfile</span></code></dt><dd><p>Specifies the input filename.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">obsdataout</span></code></dt><dd><p>This section contains information about the observation output data.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">engine</span></code></dt><dd><p>This section specifies parameters required for the file matching engine.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>Specifies the type of output observation data. Valid values: <code class="docutils literal notranslate"><span class="pre">H5File</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">obsfile</span></code></dt><dd><p>Specifies the output file path.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="obs-operator">
<h6><span class="section-number">4.1.1.1.7.2. </span><code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">operator:</span></code><a class="headerlink" href="#obs-operator" title="Permalink to this headline"></a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">operator:</span></code> section describes the observation operator and its options. An observation operator is used for computing H(x).</p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Specifies the name in the <code class="docutils literal notranslate"><span class="pre">ObsOperator</span></code> and <code class="docutils literal notranslate"><span class="pre">LinearObsOperator</span></code> factory, defined in the C++ code. Valid values include: <code class="docutils literal notranslate"><span class="pre">Identity</span></code> | <code class="docutils literal notranslate"><span class="pre">Composite</span></code> | <code class="docutils literal notranslate"><span class="pre">Categorical</span></code>. See <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/latest/inside/jedi-components/ufo/obsops.html">JEDI Documentation</a> for more options.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="obs-error">
<h6><span class="section-number">4.1.1.1.7.3. </span><code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">error:</span></code><a class="headerlink" href="#obs-error" title="Permalink to this headline"></a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">error:</span></code> section explains how to calculate the observation error covariance matrix and gives instructions (required for DA applications). The key covariance model, which describes how observation error covariances are created, is frequently the first item in this section. For diagonal observation error covariances, only the diagonal option is currently supported.</p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">covariance</span> <span class="pre">model</span></code></dt><dd><p>Specifies the covariance model. Valid values: <code class="docutils literal notranslate"><span class="pre">diagonal</span></code></p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="obs-localizations">
<h6><span class="section-number">4.1.1.1.7.4. </span><code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">localizations:</span></code><a class="headerlink" href="#obs-localizations" title="Permalink to this headline"></a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">localizations:</span></code> section describes…</p>
<blockquote>
<div><dl>
<dt><code class="docutils literal notranslate"><span class="pre">localization</span> <span class="pre">method</span></code></dt><dd><p>Specifies the observation localization method. Valid values: <code class="docutils literal notranslate"><span class="pre">Horizontal</span> <span class="pre">SOAR</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Horizontal SOAR</p></td>
<td></td>
</tr>
</tbody>
</table>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lengthscale</span></code></dt><dd><p>Localization distance in meters. Format is e-notation. For example: <code class="docutils literal notranslate"><span class="pre">250e3</span></code></p>
<blockquote>
<div></div></blockquote>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">soar</span> <span class="pre">horizontal</span> <span class="pre">decay</span></code></dt><dd><p>Second-order autoregressive (SOAR) horizontal decay.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">nobs</span></code></dt><dd><p>Maximum number of observations.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="obs-filters">
<h6><span class="section-number">4.1.1.1.7.5. </span><code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">filters:</span></code><a class="headerlink" href="#obs-filters" title="Permalink to this headline"></a></h6>
<p>Observation filters are used to define Quality Control (QC) filters. They have access to observation values and metadata, model values at observation locations, simulated observation value, and their own private data. See <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/latest/inside/jedi-components/ufo/qcfilters/introduction.html#observation-filters">Observation Filters</a> in the JEDI Documentation for more detail. The <code class="docutils literal notranslate"><span class="pre">obs</span> <span class="pre">filters:</span></code> section contains the following fields:</p>
<blockquote>
<div><dl>
<dt><code class="docutils literal notranslate"><span class="pre">filter</span></code></dt><dd><p>Describes the parameters of a given QC filter. Valid values include: <code class="docutils literal notranslate"><span class="pre">Bounds</span> <span class="pre">Check</span></code> | <code class="docutils literal notranslate"><span class="pre">Background</span> <span class="pre">Check</span></code> | <code class="docutils literal notranslate"><span class="pre">Domain</span> <span class="pre">Check</span></code> | <code class="docutils literal notranslate"><span class="pre">RejectList</span></code>. See descriptions in the JEDI’s <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/latest/inside/jedi-components/ufo/qcfilters/GenericQC.html">Generic QC Filters</a> Documentation for more.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Filter Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Bounds Check</p></td>
<td><p>Rejects observations whose values lie outside
specified limits:</p></td>
</tr>
<tr class="row-odd"><td><p>Background Check</p></td>
<td><p>This filter checks for bias-corrected distance
between the observation value and model-simulated
value (<em>y</em> - <em>H(x)</em>) and rejects observations
where the absolute difference is larger than
the <code class="docutils literal notranslate"><span class="pre">absolute</span> <span class="pre">threshold</span></code> or <code class="docutils literal notranslate"><span class="pre">threshold</span></code> *
<em>observation error</em> or <code class="docutils literal notranslate"><span class="pre">threshold</span></code> *
<em>background error</em>.</p></td>
</tr>
<tr class="row-even"><td><p>Domain Check</p></td>
<td><p>This filter retains all observations selected by
the <code class="docutils literal notranslate"><span class="pre">where</span></code> statement and rejects all others.</p></td>
</tr>
<tr class="row-odd"><td><p>RejectList</p></td>
<td><p>This is an alternative name for the BlackList
filter, which rejects all observations selected
by the <code class="docutils literal notranslate"><span class="pre">where</span></code> statement. The status of all
others remains the same. Opposite of Domain
Check filter.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">filter</span> <span class="pre">variables</span></code></dt><dd><p>Limit the action of a QC filter to a subset of variables or to specific channels.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Name of the filter variable. Users may indicate additional filter variables using the <code class="docutils literal notranslate"><span class="pre">name</span></code> field on consecutive lines (see code snippet below). Valid values: <code class="docutils literal notranslate"><span class="pre">totalSnowDepth</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">filter variables:</span>
<span class="go">- name: variable_1</span>
<span class="go">- name: variable_2</span>
</pre></div>
</div>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">minvalue</span></code></dt><dd><p>Minimum value for variables in the filter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxvalue</span></code></dt><dd><p>Maximum value for variables in the filter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">threshold</span></code></dt><dd><p>This variable may function differently depending on the filter it is used in. In the <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/latest/inside/jedi-components/ufo/qcfilters/GenericQC.html#background-check-filter">Background Check Filter</a>, an observation is rejected when the difference between the observation value (<em>y</em>) and model simulated value (<em>H(x)</em>) is larger than the <code class="docutils literal notranslate"><span class="pre">threshold</span></code> * <em>observation error</em>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">action</span></code></dt><dd><p>Indicates which action to take once an observation has been flagged by a filter. See <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/latest/inside/jedi-components/ufo/qcfilters/FilterOptions.html#filter-actions">Filter Actions</a> in the JEDI documentation for a full explanation and list of valid values.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>The name of the desired action. Valid values include: <code class="docutils literal notranslate"><span class="pre">accept</span></code> | <code class="docutils literal notranslate"><span class="pre">reject</span></code></p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">where</span></code></dt><dd><p>By default, filters are applied to all filter variables listed. The <code class="docutils literal notranslate"><span class="pre">where</span></code> keyword applies a filter only to observations meeting certain conditions. See the <a class="reference external" href="https://jointcenterforsatellitedataassimilation-jedi-docs.readthedocs-hosted.com/en/latest/inside/jedi-components/ufo/qcfilters/FilterOptions.html#where-statement">Where Statement</a> section of the JEDI Documentation for a complete description of valid <code class="docutils literal notranslate"><span class="pre">where</span></code> conditions.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">variable</span></code></dt><dd><p>A list of variables to check using the <code class="docutils literal notranslate"><span class="pre">where</span></code> statement.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Name of a variable to check using the <code class="docutils literal notranslate"><span class="pre">where</span></code> statement. Multiple variable names may be listed under <code class="docutils literal notranslate"><span class="pre">variable</span></code>. The conditions in the where statement will be applied to all of them. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">filter: Domain Check # land only</span>
<span class="go">  where:</span>
<span class="go">  - variable:</span>
<span class="go">      name: variable_1</span>
<span class="go">      name: variable_2</span>
<span class="go">    minvalue: 0.5</span>
<span class="go">    maxvalue: 1.5</span>
</pre></div>
</div>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">minvalue</span></code></dt><dd><p>Minimum value for variables in the <code class="docutils literal notranslate"><span class="pre">where</span></code> statement.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxvalue</span></code></dt><dd><p>Maximum value for variables in the <code class="docutils literal notranslate"><span class="pre">where</span></code> statement.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="set-and-submit-the-da-cycle">
<h2><span class="section-number">4.2. </span>Set and Submit the DA cycle<a class="headerlink" href="#set-and-submit-the-da-cycle" title="Permalink to this headline"></a></h2>
<p>This chapter explains how to set up and run the Noah-MP offline DA system. Users should expect to run the given snow data assimilation example using the Global Historical Climatology Network (GHCN) snow depth observations and also create their own experiment by modifying the set-up to suit user goals.</p>
<div class="section" id="input-files">
<h3><span class="section-number">4.2.1. </span>Input Files<a class="headerlink" href="#input-files" title="Permalink to this headline"></a></h3>
<p>The DA system requires grid description files and restart files.</p>
<div class="section" id="grid-description-files">
<h4><span class="section-number">4.2.1.1. </span>Grid Description Files<a class="headerlink" href="#grid-description-files" title="Permalink to this headline"></a></h4>
<p>The grid description files appear in <a class="reference internal" href="Model_v0.html#v2tinputfiles"><span class="std std-numref">Section 3.3.2</span></a> and are also used as input files to the Vector-to-Tile Converter. See <a class="reference internal" href="Model_v0.html#gridinputfiles"><span class="std std-numref">Table 3.3</span></a> for a description of these files.</p>
</div>
<div class="section" id="restart-files">
<h4><span class="section-number">4.2.1.2. </span>Restart Files<a class="headerlink" href="#restart-files" title="Permalink to this headline"></a></h4>
<p>The Noah-MP Offline Land DA System reads a restart file named <code class="docutils literal notranslate"><span class="pre">ufs_land_restart.{FILEDATE}.nc</span></code> where <code class="docutils literal notranslate"><span class="pre">FILEDATE</span></code> is in YYYY-MM-DD_HH-mm-ss format (e.g., <code class="docutils literal notranslate"><span class="pre">ufs_land_restart.2016-01-02_18-00-00.nc</span></code>). The restart file contains all the model fields and their values at a specific point in time; this information can be used to restart the model immediately to run the next cycle. <a class="reference internal" href="#restartfiles"><span class="std std-numref">Table 4.1</span></a> lists the fields in the Land DA System restart file.</p>
<span id="restartfiles"></span><table class="docutils align-default" id="id8">
<caption><span class="caption-number">Table 4.1 </span><span class="caption-text">Files Included in ufs_land_restart.{FILEDATE}.nc</span><a class="headerlink" href="#id8" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 42%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Long name</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>time</p></td>
<td><p>time</p></td>
<td><p>“seconds since
1970-01-01 00:00:00”</p></td>
</tr>
<tr class="row-odd"><td><p>timestep</p></td>
<td><p>time step</p></td>
<td><p>“seconds”</p></td>
</tr>
<tr class="row-even"><td><p>vegetation_fraction</p></td>
<td><p>Vegetation fraction</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-odd"><td><p>emissivity_total</p></td>
<td><p>surface emissivity</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-even"><td><p>albedo_direct_vis</p></td>
<td><p>surface albedo - direct visible</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-odd"><td><p>albedo_direct_nir</p></td>
<td><p>surface albedo - direct NIR</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-even"><td><p>albedo_diffuse_vis</p></td>
<td><p>surface albedo - diffuse visible</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-odd"><td><p>albedo_diffuse_nir</p></td>
<td><p>surface albedo - diffuse NIR</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-even"><td><p>temperature_soil_bot</p></td>
<td><p>deep soil temperature</p></td>
<td><p>“K”</p></td>
</tr>
<tr class="row-odd"><td><p>cm_noahmp</p></td>
<td><p>surface exchange coefficient
for momentum</p></td>
<td><p>“m/s”</p></td>
</tr>
<tr class="row-even"><td><p>ch_noahmp</p></td>
<td><p>surface exchange coefficient
heat &amp; moisture</p></td>
<td><p>“m/s”</p></td>
</tr>
<tr class="row-odd"><td><p>forcing_height</p></td>
<td><p>height of forcing</p></td>
<td><p>“m”</p></td>
</tr>
<tr class="row-even"><td><p>max_vegetation_frac</p></td>
<td><p>maximum fractional coverage of
vegetation</p></td>
<td><p>“fraction”</p></td>
</tr>
<tr class="row-odd"><td><p>albedo_total</p></td>
<td><p>grid composite albedo</p></td>
<td><p>“fraction”</p></td>
</tr>
<tr class="row-even"><td><p>snow_water_equiv</p></td>
<td><p>snow water equivalent</p></td>
<td><p>“mm”</p></td>
</tr>
<tr class="row-odd"><td><p>snow_depth</p></td>
<td><p>snow depth</p></td>
<td><p>“m”</p></td>
</tr>
<tr class="row-even"><td><p>temperature_radiative</p></td>
<td><p>surface radiative temperature</p></td>
<td><p>“K”</p></td>
</tr>
<tr class="row-odd"><td><p>soil_moisture_vol</p></td>
<td><p>volumetric moisture content in
soil level</p></td>
<td><p>“m3/m3”</p></td>
</tr>
<tr class="row-even"><td><p>temperature_soil</p></td>
<td><p>temperature in soil
level</p></td>
<td><p>“K”</p></td>
</tr>
<tr class="row-odd"><td><p>soil_liquid_vol</p></td>
<td><p>volumetric liquid
content in soil level</p></td>
<td><p>“m3/m3”</p></td>
</tr>
<tr class="row-even"><td><p>canopy_water</p></td>
<td><p>canopy moisture
content</p></td>
<td><p>“m”</p></td>
</tr>
<tr class="row-odd"><td><p>transpiration_heat</p></td>
<td><p>plant transpiration</p></td>
<td><p>“W/m2”</p></td>
</tr>
<tr class="row-even"><td><p>friction_velocity</p></td>
<td><p>friction velocity</p></td>
<td><p>“m/s”</p></td>
</tr>
<tr class="row-odd"><td><p>z0_total</p></td>
<td><p>surface roughness</p></td>
<td><p>“m”</p></td>
</tr>
<tr class="row-even"><td><p>snow_cover_fraction</p></td>
<td><p>snow cover fraction</p></td>
<td><p>“fraction”</p></td>
</tr>
<tr class="row-odd"><td><p>spec_humidity_surface</p></td>
<td><p>diagnostic specific humidity at
surface</p></td>
<td><p>“kg/kg”</p></td>
</tr>
<tr class="row-even"><td><p>ground_heat_total</p></td>
<td><p>soil heat flux</p></td>
<td><p>“W/m2”</p></td>
</tr>
<tr class="row-odd"><td><p>runoff_baseflow</p></td>
<td><p>drainage runoff</p></td>
<td><p>“mm/s”</p></td>
</tr>
<tr class="row-even"><td><p>latent_heat_total</p></td>
<td><p>latent heat flux</p></td>
<td><p>“W/m2”</p></td>
</tr>
<tr class="row-odd"><td><p>sensible_heat_flux</p></td>
<td><p>sensible heat flux</p></td>
<td><p>“W/m2”</p></td>
</tr>
<tr class="row-even"><td><p>evaporation_potential</p></td>
<td><p>potential evaporation</p></td>
<td><p>“mm/s”</p></td>
</tr>
<tr class="row-odd"><td><p>runoff_surface</p></td>
<td><p>surface runoff</p></td>
<td><p>“mm/s”</p></td>
</tr>
<tr class="row-even"><td><p>latent_heat_ground</p></td>
<td><p>direct soil latent heat flux</p></td>
<td><p>“W/m2”</p></td>
</tr>
<tr class="row-odd"><td><p>latent_heat_canopy</p></td>
<td><p>canopy water latent heat flux</p></td>
<td><p>“W/m2”</p></td>
</tr>
<tr class="row-even"><td><p>snow_sublimation</p></td>
<td><p>sublimation/deposit from snowpack</p></td>
<td><p>“mm/s”</p></td>
</tr>
<tr class="row-odd"><td><p>soil_moisture_total</p></td>
<td><p>total soil column moisture
content</p></td>
<td><p>“mm”</p></td>
</tr>
<tr class="row-even"><td><p>precip_adv_heat_total</p></td>
<td><p>precipitation advected heat -
total</p></td>
<td><p>“W/m2”</p></td>
</tr>
<tr class="row-odd"><td><p>cosine_zenith</p></td>
<td><p>cosine of zenith angle</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-even"><td><p>snow_levels</p></td>
<td><p>active snow levels</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-odd"><td><p>temperature_leaf</p></td>
<td><p>leaf temperature</p></td>
<td><p>“K”</p></td>
</tr>
<tr class="row-even"><td><p>temperature_ground</p></td>
<td><p>ground temperature</p></td>
<td><p>“K”</p></td>
</tr>
<tr class="row-odd"><td><p>canopy_ice</p></td>
<td><p>canopy ice</p></td>
<td><p>“mm”</p></td>
</tr>
<tr class="row-even"><td><p>canopy_liquid</p></td>
<td><p>canopy liquid</p></td>
<td><p>“mm”</p></td>
</tr>
<tr class="row-odd"><td><p>vapor_pres_canopy_air</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>temperature_canopy_air</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>canopy_wet_fraction</p></td>
<td><p>fraction of canopy covered by
water</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-even"><td><p>snow_water_equiv_old</p></td>
<td><p>snow water equivalent - before
integration</p></td>
<td><p>“mm”</p></td>
</tr>
<tr class="row-odd"><td><p>snow_albedo_old</p></td>
<td><p>snow albedo - before integration</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-even"><td><p>snowfall</p></td>
<td><p>snowfall</p></td>
<td><p>“mm/s”</p></td>
</tr>
<tr class="row-odd"><td><p>lake_water</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>depth_water_table</p></td>
<td><p>depth to water table</p></td>
<td><p>“m”</p></td>
</tr>
<tr class="row-odd"><td><p>aquifer_water</p></td>
<td><p>aquifer water content</p></td>
<td><p>“mm”</p></td>
</tr>
<tr class="row-even"><td><p>saturated_water</p></td>
<td><p>aquifer + saturated soil water
content</p></td>
<td><p>“mm”</p></td>
</tr>
<tr class="row-odd"><td><p>leaf_carbon</p></td>
<td><p>carbon in leaves</p></td>
<td><p>“g/m2”</p></td>
</tr>
<tr class="row-even"><td><p>root_carbon</p></td>
<td><p>carbon in roots</p></td>
<td><p>“g/m2”</p></td>
</tr>
<tr class="row-odd"><td><p>stem_carbon</p></td>
<td><p>carbon in stems</p></td>
<td><p>“g/m2”</p></td>
</tr>
<tr class="row-even"><td><p>wood_carbon</p></td>
<td><p>carbon in wood</p></td>
<td><p>“g/m2”</p></td>
</tr>
<tr class="row-odd"><td><p>soil_carbon_stable</p></td>
<td><p>stable carbon in soil</p></td>
<td><p>“g/m2”</p></td>
</tr>
<tr class="row-even"><td><p>soil_carbon_fast</p></td>
<td><p>fast carbon in soil</p></td>
<td><p>“g/m2”</p></td>
</tr>
<tr class="row-odd"><td><p>leaf_area_index</p></td>
<td><p>leaf area index</p></td>
<td><p>“m2/m2”</p></td>
</tr>
<tr class="row-even"><td><p>stem_area_index</p></td>
<td><p>stem area index</p></td>
<td><p>“m2/m2”</p></td>
</tr>
<tr class="row-odd"><td><p>snow_age</p></td>
<td><p>BATS non-dimensional snow age</p></td>
<td><p>“-“</p></td>
</tr>
<tr class="row-even"><td><p>soil_moisture_wtd</p></td>
<td><p>soil water content between bottom
of the soil and water table</p></td>
<td><p>“m3/m3”</p></td>
</tr>
<tr class="row-odd"><td><p>deep_recharge</p></td>
<td><p>deep recharge for runoff_option 5</p></td>
<td><p>“m”</p></td>
</tr>
<tr class="row-even"><td><p>recharge</p></td>
<td><p>recharge for runoff_option 5</p></td>
<td><p>“m”</p></td>
</tr>
<tr class="row-odd"><td><p>temperature_2m</p></td>
<td><p>grid diagnostic temperature at 2
meters</p></td>
<td><p>“K”</p></td>
</tr>
<tr class="row-even"><td><p>spec_humidity_2m</p></td>
<td><p>grid diagnostic specific humidity
at 2 meters</p></td>
<td><p>“kg/kg”</p></td>
</tr>
<tr class="row-odd"><td><p>eq_soil_water_vol</p></td>
<td><p>equilibrium soil water content</p></td>
<td><p>“m3/m3”</p></td>
</tr>
<tr class="row-even"><td><p>temperature_snow</p></td>
<td><p>snow level temperature</p></td>
<td><p>“K”</p></td>
</tr>
<tr class="row-odd"><td><p>interface_depth</p></td>
<td><p>layer-bottom depth from snow
surface</p></td>
<td><p>“m”</p></td>
</tr>
<tr class="row-even"><td><p>snow_level_ice</p></td>
<td><p>ice content of snow levels</p></td>
<td><p>“mm”</p></td>
</tr>
<tr class="row-odd"><td><p>snow_level_liquid</p></td>
<td><p>liquid content of snow levels</p></td>
<td><p>“mm”</p></td>
</tr>
</tbody>
</table>
<p>The restart files also include one text file, <code class="docutils literal notranslate"><span class="pre">${FILEDATE}.coupler.res</span></code>, which contains metadata for the restart.</p>
<p>Example of <code class="docutils literal notranslate"><span class="pre">${FILEDATE}.coupler.res</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">2        (Calendar: no_calendar=0, thirty_day_months=1, julian=2, gregorian=3, noleap=4)</span>
<span class="go">2016     1     2    18     0     0    Model start time:   year, month, day, hour, minute, second</span>
<span class="go">2016     1     2    18     0     0    Current model time: year, month, day, hour, minute, second</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="da-workflow">
<h3><span class="section-number">4.2.2. </span>DA Workflow<a class="headerlink" href="#da-workflow" title="Permalink to this headline"></a></h3>
<p>The cycling Noah-MP offline DA run is initiated using two shell scripts: <code class="docutils literal notranslate"><span class="pre">do_submit_cycle.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">submit_cycle.sh</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The offline Noah-MP model runs in vector space, whereas a cycling Noah-MP offline DA job uses JEDI’s tiled cubed-sphere (<a class="reference internal" href="Glossary.html#term-fv3"><span class="xref std std-term">FV3</span></a>) format. <a class="reference internal" href="Model_v0.html#vectortileconverter"><span class="std std-numref">Section 3.3</span></a> describes the Vector-to-Tile Converter that maps between these two formats.</p>
</div>
<div class="section" id="do-submit-cycle-sh">
<h4><span class="section-number">4.2.2.1. </span><code class="docutils literal notranslate"><span class="pre">do_submit_cycle.sh</span></code><a class="headerlink" href="#do-submit-cycle-sh" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">do_submit_cycle.sh</span></code> script sets up the cycling job based on the user’s input settings. <a class="reference internal" href="#dosubmitcyclepng"><span class="std std-numref">Figure 4.1</span></a> illustrates the steps in this process.</p>
<div class="figure align-default" id="id9">
<span id="dosubmitcyclepng"></span><img alt="" src="https://github.com/NOAA-EPIC/land-offline_workflow/wiki/do_submit_cycle.png" />
<p class="caption"><span class="caption-number">Fig. 4.1 </span><span class="caption-text"><em>Flowchart of ‘do_submit_cycle.sh’</em></span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</div>
<p>First, <code class="docutils literal notranslate"><span class="pre">do_submit_cycle.sh</span></code> reads in a configuration file for the cycle settings. This file contains the information required to run the cycle: the experiment name, start date, end date, the paths of the working directory and output directories, the length of each forecast, atmospheric forcing data, the Finite-Volume Cubed-Sphere Dynamical Core (<a class="reference internal" href="Glossary.html#term-fv3"><span class="xref std std-term">FV3</span></a>) resolution and its paths, the number of cycles per job, the directory with initial conditions, a namelist file for running Land DA, and different DA options. Then, the required modules are loaded, and some executables are set for running the cycle. The restart frequency and running day/hours are computed from the inputs, and directories are created for running DA and saving the DA outputs. If restart files are not in the experiment output directory, the script will try to copy the restart files from the <code class="docutils literal notranslate"><span class="pre">ICSDIR</span></code> directory, which should contain initial conditions files if restart files are not available. Then, the existing restart file is copied into each ensemble directory and used for an ensemble or single restart run. Finally, the script creates the dates file (<code class="docutils literal notranslate"><span class="pre">analdates.sh</span></code>) and submits the <code class="docutils literal notranslate"><span class="pre">submit_cycle.sh</span></code> script, which is described in detail in the next section.</p>
</div>
<div class="section" id="submit-cycle-sh">
<h4><span class="section-number">4.2.2.2. </span><code class="docutils literal notranslate"><span class="pre">submit_cycle.sh</span></code><a class="headerlink" href="#submit-cycle-sh" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">submit_cycle.sh</span></code> script first exports the required paths and loads the required modules. Then, it reads the dates file and runs through all the steps for submitting a cycle if the count of dates is less than or equal to the number of cycles per job (see <a class="reference internal" href="#submitcyclepng"><span class="std std-numref">Figure 4.2</span></a>).</p>
<div class="figure align-default" id="id10">
<span id="submitcyclepng"></span><img alt="" src="https://github.com/NOAA-EPIC/land-offline_workflow/wiki/submit_cycle.png" />
<p class="caption"><span class="caption-number">Fig. 4.2 </span><span class="caption-text"><em>Flowchart of ‘submit_cycle.sh’</em></span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</div>
<p>As the script loops through the steps in the process for each cycle, it reads in the DA settings and selects a run type — either DA or <code class="docutils literal notranslate"><span class="pre">openloop</span></code> (which skips DA). Required DA settings include: DA algorithm choice, directory paths for JEDI, Land_DA (where the <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code> script is located), JEDI’s input observation options, DA window length, options for constructing <code class="docutils literal notranslate"><span class="pre">yaml</span></code> files, etc.</p>
<p>Next, the system designates work and output directories and copies restart files into the working directory. If the DA option is selected, the script calls the <code class="docutils literal notranslate"><span class="pre">vector2tile</span></code> function and tries to convert the format of the Noah-MP model in vector space to the JEDI tile format used in <a class="reference internal" href="Glossary.html#term-fv3"><span class="xref std std-term">FV3</span></a> cubed-sphere space. After the <code class="docutils literal notranslate"><span class="pre">vector2tile</span></code> is done, the script calls the data assimilation job script (<code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code>) and runs this script. Then, the <code class="docutils literal notranslate"><span class="pre">tile2vector</span></code> function is called and converts the JEDI output tiles back to vector format. The converted vector outputs are saved, and the forecast model is run. Then, the script checks the existing model outputs. Finally, if the current date is less than the end date, this same procedure will be processed for the next cycle.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The v1.0.0 release of Land DA does not support ensemble runs. Thus, the first ensemble member is the only ensemble member.</p>
</div>
<p>Here is an example of configuration settings file, <code class="docutils literal notranslate"><span class="pre">settings_cycle</span></code>, for the <code class="docutils literal notranslate"><span class="pre">submit_cycle</span></code> script:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export exp_name=DA_IMS_test</span>
<span class="go">STARTDATE=2016010118</span>
<span class="go">ENDDATE=2016010318</span>

<span class="go">export WORKDIR=/*/*/</span>
<span class="go">export OUTDIR=/*/*/</span>

<span class="gp">#</span><span class="c1">###########################</span>

<span class="gp">#</span> <span class="k">for</span> LETKF,
<span class="go">export ensemble_size=1</span>

<span class="go">export FCSTHR=24</span>

<span class="go">export atmos_forc=gdas</span>

<span class="gp">#</span>FV3 resolution
<span class="go">export RES=96</span>
<span class="go">export TPATH=&quot;/*/*/&quot;</span>
<span class="go">export TSTUB=&quot;oro_C96.mx100&quot;</span>

<span class="gp">#</span> number of cycles
<span class="go">export cycles_per_job=1</span>

<span class="gp">#</span> directory with initial conditions
<span class="go">export ICSDIR=/*/*/</span>

<span class="gp">#</span> namelist <span class="k">for</span> do_landDA.sh
<span class="go">export DA_config=&quot;settings_DA_test&quot;</span>

<span class="gp">#</span> <span class="k">if</span> want different DA at different times, list here.
<span class="go">export DA_config00=${DA_config}</span>
<span class="go">export DA_config06=${DA_config}</span>
<span class="go">export DA_config12=${DA_config}</span>
<span class="go">export DA_config18=${DA_config}</span>
</pre></div>
</div>
<div class="section" id="parameters-for-submit-cycle-sh">
<h5><span class="section-number">4.2.2.2.1. </span>Parameters for <code class="docutils literal notranslate"><span class="pre">submit_cycle.sh</span></code><a class="headerlink" href="#parameters-for-submit-cycle-sh" title="Permalink to this headline"></a></h5>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">exp_name</span></code></dt><dd><p>Specifies the name of experiment.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">STARTDATE</span></code></dt><dd><p>Specifies the experiment start date. The form is YYYYMMDDHH, where YYYY is a 4-digit year, MM is a valid 2-digit month, DD is a valid 2-digit day, and HH is a valid 2-digit hour.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ENDDATE</span></code></dt><dd><p>Specifies the experiment end date. The form is YYYYMMDDHH, where YYYY is a 4-digit year, MM is a valid 2-digit month, DD is a valid 2-digit day, and HH is a valid 2-digit hour.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">WORKDIR</span></code></dt><dd><p>Specifies the path to a temporary directory from which the experiment is run.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">OUTDIR</span></code></dt><dd><p>Specifies the path to a directory where experiment output is saved.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ensemble_size</span></code></dt><dd><p>Specifies the size of the ensemble (i.e., number of ensemble members). Use <code class="docutils literal notranslate"><span class="pre">1</span></code> for non-ensemble runs.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">FCSTHR</span></code></dt><dd><p>Specifies the length of each forecast in hours.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">atmos_forc</span></code></dt><dd><p>Specifies the atmospheric forcing.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">RES</span></code></dt><dd><p>Specifies the resolution of FV3. Valid values: <code class="docutils literal notranslate"><span class="pre">C96</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">TPATH</span></code></dt><dd><p>Specifies the path to the orography files.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">TSTUB</span></code></dt><dd><p>Specifies the file stub/name for orography files in <code class="docutils literal notranslate"><span class="pre">TPATH</span></code>. This file stub is named <code class="docutils literal notranslate"><span class="pre">oro_C${RES}</span></code> for atmosphere-only and <code class="docutils literal notranslate"><span class="pre">oro_C{RES}.mx100</span></code> for atmosphere and ocean.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cycles_per_job</span></code></dt><dd><p>Specifies the number of cycles to submit in a single job.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ICSDIR</span></code></dt><dd><p>Specifies the path to a directory containing initial conditions data.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DA_config</span></code></dt><dd><p>Specifies the configuration setting file for <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code>. Set <code class="docutils literal notranslate"><span class="pre">DA_config</span></code> to <code class="docutils literal notranslate"><span class="pre">openloop</span></code> to skip data assimilation (and prevent a call <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DA_configXX</span></code></dt><dd><p>Specifies the configuration setting file for <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code> at <code class="docutils literal notranslate"><span class="pre">XX</span></code> hr. Set to <code class="docutils literal notranslate"><span class="pre">openloop</span></code> to skip data assimilation (and prevent a call <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code>).</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="do-landda-sh">
<h4><span class="section-number">4.2.2.3. </span><code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code><a class="headerlink" href="#do-landda-sh" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code> runs the data assimilation job inside the <code class="docutils literal notranslate"><span class="pre">sumbit_cycle.sh</span></code> script. Currently, the only DA option is the snow Two Local Ensemble Transform Kalman Filter (LETKF, <span id="id7">Hunt <em>et al.</em> [<a class="reference internal" href="Introduction_v0.html#id22" title="B.R. Hunt, E.J. Kostelich, and I. Szunyogh. Efficient data assimilation for spatiotemporal chaos: a local ensemble transform kalman filter. Physica D: Nonlinear Phenomena, 230(1–2):112–126, 2007. doi:10.1016/j.physd.2006.11.008.">HEJKS07</a>]</span>). <a class="reference internal" href="#dolanddapng"><span class="std std-numref">Figure 4.3</span></a> describes the workflow of this script.</p>
<div class="figure align-default" id="id11">
<span id="dolanddapng"></span><img alt="" src="https://github.com/NOAA-EPIC/land-offline_workflow/wiki/do_landDA.png" />
<p class="caption"><span class="caption-number">Fig. 4.3 </span><span class="caption-text"><em>Flowchart of ‘do_landDA.sh’</em></span><a class="headerlink" href="#id11" title="Permalink to this image"></a></p>
</div>
<p>First, to run the DA job, <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code> reads in the configuration file and sets up the directories. The date strings are formatted for the current date and previous date. For each tile, restarts are staged to apply the JEDI update. In this stage, all files will get directly updated. Then, the observation files are read and prepared for this job. Note that currently the Interactive Multisensor Snow and Ice Mapping System (IMS) data are the only data available. For pre-processing, fIMS is called to calculate fractional snow cover on the model grid from the IMS snow cover observations. Then, SWE is calculated from fractional snow cover, assuming the snow depletion curve used by the Noah model. Once this pre-processing job is complete, the script calls the JEDI Interface for Observation Data Access (IODA) converter to provide the interfaces that bridge the differences between the external observation data and the components within JEDI that utilize those data. Once the JEDI type is determined, <code class="docutils literal notranslate"><span class="pre">yaml</span></code> files are constructed. Note that if the user specifies a <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file, the script uses that one. Otherwise, the script builds the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> files.  For LETKF, a pseudo-ensemble is created by running the python script (<code class="docutils literal notranslate"><span class="pre">letkf_create_ens.py</span></code>). Once the ensemble is created, the script runs JEDI and applies increment to UFS restarts.</p>
<p>Below, users can find an example of a configuration settings file, <code class="docutils literal notranslate"><span class="pre">settings_DA</span></code>, for the <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code> script:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">LANDDADIR=${CYCLEDIR}/DA_update/</span>

<span class="gp">#</span><span class="c1">###########################</span>
<span class="gp">#</span> DA options

<span class="go">OBS_TYPES=(&quot;GHCN&quot;)</span>
<span class="go">JEDI_TYPES=(&quot;DA&quot;)</span>

<span class="go">WINLEN=24</span>

<span class="gp">#</span> YAMLS
<span class="go">YAML_DA=construct</span>

<span class="gp">#</span> JEDI DIRECTORIES
<span class="go">JEDI_EXECDIR=</span>
<span class="go">fv3bundle_vn=20230106_public</span>
</pre></div>
</div>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">LANDDADIR</span></code></dt><dd><p>Specifies the path to the <code class="docutils literal notranslate"><span class="pre">do_landDA.sh</span></code> script.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">OBS_TYPES</span></code></dt><dd><p>Specifies the observation type. Format is “Obs1” “Obs2”. Currently, only GHCN observation data is available.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">JEDI_TYPES</span></code></dt><dd><p>Specifies the JEDI call type for each observation type above. Format is “type1” “type2”. Valid values: <code class="docutils literal notranslate"><span class="pre">DA</span></code> | <code class="docutils literal notranslate"><span class="pre">HOFX</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 88%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DA</p></td>
<td><p>Data assimilation</p></td>
</tr>
<tr class="row-odd"><td><p>HOFX</p></td>
<td><p>A generic application for running the model forecast
(or reading forecasts from file) and computing H(x)</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">WINLEN</span></code></dt><dd><p>Specifies the DA window length. It is generally the same as the <code class="docutils literal notranslate"><span class="pre">FCSTLEN</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">YAML_DA</span></code></dt><dd><p>Specifies whether to construct the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> name based on requested observation types and their availabilities. Valid values: <code class="docutils literal notranslate"><span class="pre">construct</span></code> | <em>desired YAML name</em></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>construct</p></td>
<td><p>Enable constructing the YAML</p></td>
</tr>
<tr class="row-odd"><td><p>desired YAML name</p></td>
<td><p>Will not test for availability of observations</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">JEDI_EXECDIR</span></code></dt><dd><p>Specifies the JEDI FV3 build directory. If using different JEDI version, users will need to edit the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> files.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fv3bundle_vn</span></code></dt><dd><p>Specifies the date for <code class="docutils literal notranslate"><span class="pre">jedi-fv3</span></code> bundle checkout (used to select correct yaml).</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="configure-the-experiment">
<span id="configureexpt"></span><h3><span class="section-number">4.2.3. </span>Configure the Experiment<a class="headerlink" href="#configure-the-experiment" title="Permalink to this headline"></a></h3>
<p>Coming soon!</p>
</div>
<div class="section" id="submit-the-experiment">
<span id="submitexpt"></span><h3><span class="section-number">4.2.4. </span>Submit the Experiment<a class="headerlink" href="#submit-the-experiment" title="Permalink to this headline"></a></h3>
<p>Navigate back to the <code class="docutils literal notranslate"><span class="pre">land-offline_workflow</span></code> directory and submit the experiment using the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command. It will run through two cycles (two days).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ..</span>
<span class="go">sbatch submit_cycle.sh</span>
</pre></div>
</div>
<p>The system will output a message such as <code class="docutils literal notranslate"><span class="pre">Submitted</span> <span class="pre">batch</span> <span class="pre">job</span> <span class="pre">########</span></code>, indicating that the job was successfully submitted. If all goes well, a full cycle will run with data assimilation (DA) and a forecast.</p>
<p>To check on the job status, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">squeue -u $USER</span>
</pre></div>
</div>
<p>To view progress, users can open the <code class="docutils literal notranslate"><span class="pre">log</span></code> and <code class="docutils literal notranslate"><span class="pre">err</span></code> files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tail -f log* err*</span>
</pre></div>
</div>
<p>Users will need to hit <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code> to exit the file.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>If the log file contains a NetCDF error (e.g., <code class="docutils literal notranslate"><span class="pre">ModuleNotFoundError:</span> <span class="pre">No</span> <span class="pre">module</span> <span class="pre">named</span> <span class="pre">'netCDF4'</span></code>), run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python -m pip install netCDF4</span>
</pre></div>
</div>
<p>Then, resubmit the job (<code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">submit_cycle.sh</span></code>).</p>
</div>
<p>Next, check for the background and analysis files in the <code class="docutils literal notranslate"><span class="pre">cycle_land</span></code> directory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ls -l ../cycle_land/DA_GHCN_test/mem000/restarts/vector/</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="interface-for-observation-data-access-ioda">
<h2><span class="section-number">4.3. </span>Interface for Observation Data Access (IODA)<a class="headerlink" href="#interface-for-observation-data-access-ioda" title="Permalink to this headline"></a></h2>
<p>The code base of the JEDI Unified Forward Operator (UFO) links observation operators with the Object Oriented Prediction System (OOPS) to generically implement the computation of a simulated observation given a known model state. There is no restriction to the observation operators with regard to model specific code structures or requirements. The UFO code structure provides generic classes for observation bias correction and quality control. Then the formats of observation data are converted into model specific formats to be ingested by each model’s data assimilation system. This involves model specific data conversion efforts. Requirements for observation files and I/O handling involved in different modeling and data assimilation workflows are diverse. Creating a common software system for organizing and storing the vast amounts of observation data is highly desirable to maintain current and future operational forecast systems in a sustainable way.</p>
<p>As part of a modernization effort of the ocean forecasting systems under the umbrella of the NOAA unified forecast system (UFS) program, a data unification project has been started with the Joint Effort for Data Assimilation Integration (JEDI) to establish a model agnostic method of sharing observation data and exchanging modeling and data assimilation results. The Interface for Observation Data Access (IODA) is a subsystem of JEDI that handles data processing and provides for a common data format in netCDF. This allows for the long-term storage of data and the creation of historical databases. The underlying structure of the IODA format is to represent the variables in columns and the locations in rows. Metadata tables are associated with each axis of the data tables and the location metadata hold the values describing each location, and which are appropriate for each observation type (e.g., latitude, longitude). Actual data values are contained in the third dimension of the IODA data table: observation values, observation error, quality control flags, and simulated observation values of H(x) at different stages of the data assimilation process. The python-based IODA converters for all the marine surface and profile observation data types described above have been successfully developed and merged into the JEDI repository.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Model_v0.html" class="btn btn-neutral float-left" title="3. Noah-MP Land Surface Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Glossary.html" class="btn btn-neutral float-right" title="5. Glossary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>